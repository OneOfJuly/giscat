package org.wowtools.giscat.vector.mvt;

import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.geom.GeometryFactory;
import org.locationtech.jts.io.WKTReader;
import org.wowtools.common.utils.ResourcesReader;
import org.wowtools.giscat.vector.pojo.Feature;

import java.util.Map;

/**
 * @author liuyu
 * @date 2022/5/17
 */
public class Test1 {
    private static final String full = "LINESTRING (100.667724609375 26.76400440347307, 100.66497802734375 26.761552039321135, 100.66497802734375 26.760325837394426, 100.67047119140625 26.761552039321135, 100.67047119140625 26.768908972959338, 100.67184448242188 26.779943479945096, 100.68557739257812 26.795880318863404, 100.68832397460938 26.81426619756147, 100.73226928710938 26.84857852587328, 100.77621459960938 26.84857852587328, 100.80642700195312 26.827747280364836, 100.81878662109375 26.82407078047018, 100.8489990234375 26.835099922223947, 100.9149169921875 26.852254230179817, 100.94100952148438 26.860830409281427, 100.96298217773438 26.862055524657794, 100.97122192382812 26.84367740111301, 100.97122192382812 26.83264909463484, 100.986328125 26.820394161280472, 100.986328125 26.800783511306562, 100.9918212890625 26.752968347950265, 100.9918212890625 26.725986812271763, 100.98358154296875 26.710040169368867, 100.98495483398438 26.697772001085667, 100.9918212890625 26.679367271566836, 100.99594116210938 26.662186843258546, 100.997314453125 26.645003827815255, 101.02203369140625 26.622907579744332, 101.0357666015625 26.615541214194334, 101.05911254882812 26.597123224094695, 101.06735229492188 26.572561292150358, 101.07421875 26.56519168524269, 101.08795166015625 26.547994092666023, 101.09893798828125 26.54308002096242, 101.11679077148438 26.528336542726343, 101.15249633789062 26.522192867724723, 101.15798950195312 26.51973530566078, 101.1676025390625 26.51727769099434, 101.17584228515625 26.508675625466076, 101.20330810546875 26.49024045886962, 101.2060546875 26.47917793965339, 101.21292114257812 26.45704970933647, 101.22665405273438 26.445983998856377, 101.239013671875 26.43860626788731, 101.26235961914062 26.41524033698521, 101.28158569335938 26.39556009143024, 101.29531860351562 26.385718710212796, 101.3214111328125 26.382027976025352, 101.32278442382812 26.37341580433951, 101.38046264648438 26.343883486293993, 101.38595581054688 26.33649922848402, 101.3983154296875 26.32542195842116, 101.43951416015625 26.29218379104661, 101.45462036132812 26.284796237242805, 101.46286010742188 26.272482602093056, 101.46835327148438 26.255241318104897, 101.4752197265625 26.23307019223549, 101.47659301757812 26.22444694563432, 101.50405883789062 26.193644418207565, 101.51229858398438 26.168996529230174, 101.53427124023438 26.134480730291475, 101.53976440429688 26.128316120642413, 101.54937744140625 26.09995472652246, 101.57272338867188 26.069119321860896, 101.57821655273438 26.06048395300777, 101.62628173828125 26.02470207419854, 101.6290283203125 26.00865837808847, 101.63589477539062 25.99508123057506, 101.6400146484375 25.99508123057506, 101.68807983398438 25.99384686662551, 101.70867919921875 25.986440410641343, 101.72653198242188 25.976564410019794, 101.7498779296875 25.96915686519399, 101.75262451171875 25.96915686519399, 101.77322387695312 25.958044673317847, 101.80343627929688 25.92840703269412, 101.82266235351562 25.901232645855213, 101.82815551757812 25.885172110862516, 101.84326171875 25.880229968183286, 101.8597412109375 25.882701065377603, 101.88308715820312 25.864166576246408, 101.89407348632812 25.851808634972723, 101.89956665039062 25.83944940206318, 101.9091796875 25.8295610860535, 101.93801879882812 25.819671943904044, 101.94351196289062 25.814727063097397, 101.95587158203125 25.812254545273426, 101.97372436523438 25.792472545052053, 101.98471069335938 25.776397239042776, 101.986083984375 25.757846102306225, 101.99020385742188 25.747950977397586, 101.99981689453125 25.744240093036264, 102.02316284179688 25.744240093036264, 102.0355224609375 25.738055028213893, 102.03964233398438 25.739292066931654, 102.04925537109375 25.73434383480783, 102.06024169921875 25.7244467526159, 102.06710815429688 25.71578612996864, 102.073974609375 25.709599584892448, 102.0849609375 25.70465011724858, 102.10418701171875 25.70093788144428, 102.10693359375 25.693513062561046, 102.10968017578125 25.691038020050133, 102.1234130859375 25.682374966229354, 102.139892578125 25.673711282473874, 102.161865234375 25.671235828577043, 102.17559814453125 25.662571335129307, 102.18795776367188 25.662571335129307, 102.23190307617188 25.667522551344298, 102.26348876953125 25.676186684959898, 102.27859497070312 25.68361258391759, 102.28408813476562 25.68361258391759, 102.30880737304688 25.694750564527013, 102.35000610351562 25.679899692285893, 102.3541259765625 25.678662036031557, 102.35824584960938 25.66876032327295, 102.37197875976562 25.656382025768064, 102.40493774414062 25.64895443060557, 102.44476318359375 25.635335971980343, 102.47360229492188 25.630383420008773, 102.48458862304688 25.630383420008773, 102.49832153320312 25.634097853244718, 102.50656127929688 25.639050251151918, 102.51205444335938 25.637812170934385, 102.51754760742188 25.632859721670616, 102.54638671875 25.63657407787705, 102.5738525390625 25.625430662642945, 102.61367797851562 25.631621577258493, 102.62191772460938 25.629145249921912, 102.63015747070312 25.615524531842528, 102.6287841796875 25.603140713507013, 102.63839721679688 25.590755612437427, 102.65487670898438 25.570936783752266, 102.67547607421875 25.556070509093836, 102.71392822265625 25.552353652165483, 102.76473999023438 25.52013606440348, 102.80319213867188 25.487909825592318, 102.843017578125 25.465594288934156, 102.864990234375 25.46187463025665, 102.9254150390625 25.45939479392253, 102.9473876953125 25.45939479392253, 102.95425415039062 25.460634718477532, 102.9693603515625 25.456914906486638, 102.996826171875 25.458154856592078, 103.02978515625 25.468073997498145, 103.040771484375 25.465594288934156, 103.062744140625 25.455674943606663, 103.08746337890625 25.438314122211377, 103.09432983398438 25.43583380055557, 103.10256958007812 25.428392529196838, 103.13552856445312 25.41474900498932, 103.16574096679688 25.406065958440834, 103.1890869140625 25.394901123031936, 103.19320678710938 25.386216648026636, 103.20556640625 25.38249453892475, 103.20968627929688 25.372568353794133, 103.216552734375 25.36636407389489, 103.23165893554688 25.3564365635121, 103.23577880859375 25.350231455520888, 103.24539184570312 25.342784905654543, 103.25225830078125 25.336579097268107, 103.24951171875 25.314235552197584, 103.24127197265625 25.30678678767567, 103.2220458984375 25.285679468429876, 103.19595336914062 25.272019833438236, 103.18496704101562 25.25214852883526, 103.1781005859375 25.242211657212827, 103.17123413085938 25.23227397301963, 103.16299438476562 25.199970890386012, 103.16848754882812 25.160201483133356, 103.18222045898438 25.14652775303499, 103.18634033203125 25.11047148622334, 103.18496704101562 25.085598897064767, 103.20968627929688 25.070672916651088, 103.21517944335938 25.05823320992254, 103.216552734375 25.053256973596103, 103.21517944335938 25.02961709253111, 103.22479248046875 25.028372762053433, 103.2275390625 25.022150920405693, 103.23028564453125 25.020906514227498, 103.23577880859375 25.024639694914814, 103.25363159179688 25.024639694914814, 103.2659912109375 25.013439812256355, 103.31130981445312 24.991036982463733, 103.36624145507812 24.974854621062857, 103.40194702148438 24.95867013057679, 103.40744018554688 24.913840438375946, 103.42391967773438 24.89266519490005, 103.42941284179688 24.877715777296835, 103.45138549804688 24.867748493872824, 103.47885131835938 24.849057671305264, 103.50082397460938 24.83908807776388, 103.50357055664062 24.821639356846617, 103.5296630859375 24.81914648173907, 103.53790283203125 24.824132181788883, 103.56536865234375 24.822885775588638, 103.57086181640625 24.824132181788883, 103.5736083984375 24.825378575446873, 103.62030029296875 24.824132181788883, 103.65188598632812 24.825378575446873, 103.66973876953125 24.825378575446873, 103.67385864257812 24.825378575446873, 103.677978515625 24.821639356846617, 103.70956420898438 24.81914648173907, 103.7164306640625 24.821639356846617, 103.73153686523438 24.821639356846617, 103.7493896484375 24.827871325134264, 103.79745483398438 24.821639356846617, 103.80569458007812 24.81914648173907, 103.809814453125 24.815407075025963, 103.81942749023438 24.79920167537383, 103.84002685546875 24.791721545708786, 103.84414672851562 24.791721545708786, 103.85101318359375 24.78673454198889, 103.87161254882812 24.78424096495712, 103.90731811523438 24.770525395673175, 103.94851684570312 24.74683129841204, 103.99246215820312 24.71814292645312, 104.00344848632812 24.714400477165388, 104.01443481445312 24.713152969066176, 104.03091430664062 24.71564797276326, 104.04739379882812 24.70566765796888, 104.05563354492188 24.696934226366686, 104.09957885742188 24.684456833487157, 104.12155151367188 24.653257887871955, 104.139404296875 24.63078981744127, 104.1558837890625 24.617057340809513, 104.19845581054688 24.60082610576977, 104.21768188476562 24.60082610576977, 104.227294921875 24.598328805778888, 104.24102783203125 24.599577462003495, 104.2767333984375 24.598328805778888, 104.30007934570312 24.608317706716104, 104.32479858398438 24.61206333896378, 104.38385009765625 24.610814807343615, 104.43328857421875 24.603323355925433, 104.47036743164062 24.607069137709686, 104.47586059570312 24.609566263260906, 104.49783325195312 24.607069137709686, 104.50469970703125 24.608317706716104, 104.5623779296875 24.603323355925433, 104.59945678710938 24.59333405630646, 104.6502685546875 24.563361375309228, 104.666748046875 24.545874000679657, 104.6942138671875 24.5308828820248, 104.70932006835938 24.517139450525146, 104.75189208984375 24.50214490121088, 104.75738525390625 24.495896644361455, 104.7711181640625 24.492147541216024, 104.820556640625 24.469650575801797, 104.85076904296875 24.467150664739, 104.86724853515625 24.46465070404222, 104.9139404296875 24.46215069371526, 104.97573852539062 24.448399749945953, 105.02792358398438 24.465900690594616, 105.04714965820312 24.467150664739, 105.10757446289062 24.459650633761875, 105.13641357421875 24.449649897759667, 105.1556396484375 24.448399749945953, 105.16525268554688 24.452150156180963, 105.18722534179688 24.449649897759667, 105.19546508789062 24.452150156180963, 105.21881103515625 24.44714958973082, 105.22842407226562 24.44714958973082, 105.24078369140625 24.44214882486563, 105.26962280273438 24.425894969115173, 105.2874755859375 24.414641072789088, 105.31082153320312 24.41214007065151, 105.32867431640625 24.40088494789552, 105.34515380859375 24.388378079531638, 105.37673950195312 24.374619094607866, 105.40969848632812 24.374619094607866, 105.42892456054688 24.369615456124507, 105.46188354492188 24.368364515573457, 105.52780151367188 24.348347784604407, 105.5511474609375 24.34584547064954, 105.59097290039062 24.33958946942516, 105.611572265625 24.33333315919509, 105.67337036132812 24.329579224758984, 105.67886352539062 24.322071022275985, 105.68710327148438 24.30955636323522, 105.699462890625 24.299543746864106, 105.71868896484375 24.294537142382712, 105.72830200195312 24.295788812018937, 105.76126098632812 24.31205939384922, 105.77774047851562 24.324573805856375, 105.83816528320312 24.337086982410494, 105.89584350585938 24.32707654001864, 105.90682983398438 24.318316754254738, 105.93154907226562 24.29328546040337, 106.03591918945312 24.26449336927064, 106.05926513671875 24.26073739806278, 106.14028930664062 24.26073739806278, 106.17462158203125 24.254477199450612, 106.19384765625 24.248216692641225, 106.2103271484375 24.248216692641225, 106.2432861328125 24.243208065331753, 106.26800537109375 24.225676317175427, 106.28036499023438 24.220666802807205, 106.29959106445312 24.22442395705756, 106.30233764648438 24.221919199872975, 106.314697265625 24.225676317175427, 106.34902954101562 24.221919199872975, 106.358642578125 24.214404632762754, 106.40121459960938 24.201879369286626, 106.43142700195312 24.18935287502558, 106.50421142578125 24.185594686815644, 106.5234375 24.180583596981712, 106.55914306640625 24.18434193280842, 106.58798217773438 24.171813716251364, 106.59622192382812 24.17306659324866, 106.59759521484375 24.175572310352194, 106.63192749023438 24.1705608269577, 106.644287109375 24.1705608269577, 106.65252685546875 24.171813716251364, 106.66900634765625 24.1705608269577, 106.68136596679688 24.171813716251364, 106.71844482421875 24.169307925368134, 106.72393798828125 24.165549146828837, 106.73904418945312 24.169307925368134, 106.77200317382812 24.180583596981712, 106.78848266601562 24.180583596981712, 106.82144165039062 24.186847428521233, 106.85989379882812 24.18935287502558, 106.86264038085938 24.190605579823394, 106.89971923828125 24.21064718298075, 106.92718505859375 24.221919199872975, 106.96563720703125 24.245712403635594, 106.98760986328125 24.261989400796303, 107.00408935546875 24.272004978717582, 107.02880859375 24.269501158235087, 107.03842163085938 24.273256870457235, 107.04116821289062 24.275760616930956, 107.05215454101562 24.292033766081378, 107.06588745117188 24.302046975036554, 107.07962036132812 24.30955636323522, 107.10296630859375 24.318316754254738, 107.1112060546875 24.31456237506409, 107.11532592773438 24.31456237506409, 107.127685546875 24.31205939384922, 107.15240478515625 24.30830482940474, 107.17025756835938 24.31205939384922, 107.18124389648438 24.310807884716873, 107.193603515625 24.307053283225912, 107.20596313476562 24.3058017246992, 107.215576171875 24.30830482940474, 107.23480224609375 24.30955636323522, 107.24441528320312 24.31205939384922, 107.25677490234375 24.310807884716873, 107.2650146484375 24.313310890631783, 107.26913452148438 24.315813847145673, 107.29110717773438 24.31456237506409, 107.30072021484375 24.313310890631783, 107.31170654296875 24.318316754254738, 107.32681274414062 24.325825179115014, 107.33505249023438 24.324573805856375, 107.34603881835938 24.32707654001864, 107.36114501953125 24.337086982410494, 107.36526489257812 24.344594295127973, 107.37350463867188 24.35335226414775, 107.38037109375 24.362109627260626, 107.38723754882812 24.368364515573457, 107.40371704101562 24.375869973296123, 107.41470336914062 24.378371693550225, 107.41744995117188 24.383374985555513, 107.4188232421875 24.383374985555513, 107.42843627929688 24.38962882208006, 107.44491577148438 24.40088494789552, 107.44903564453125 24.404636766948936, 107.46688842773438 24.407137917727656, 107.479248046875 24.415891555275127, 107.4847412109375 24.41839248307936, 107.49710083007812 24.41839248307936, 107.51632690429688 24.415891555275127, 107.52182006835938 24.419642928396602, 107.53829956054688 24.419642928396602, 107.54928588867188 24.432146700011007, 107.59048461914062 24.443399034681686, 107.63168334960938 24.46090066994163, 107.66189575195312 24.46465070404222, 107.66464233398438 24.463400705082275, 107.67013549804688 24.46840062647488, 107.68386840820312 24.477150011148673, 107.69210815429688 24.475900136285436, 107.7154541015625 24.49089781533108, 107.71957397460938 24.492147541216024, 107.72232055664062 24.495896644361455, 107.73193359375 24.498395984362524, 107.742919921875 24.50839284751807, 107.75253295898438 24.515889973088093, 107.77175903320312 24.51089193907594, 107.7813720703125 24.49964563573288, 107.78823852539062 24.50214490121088, 107.808837890625 24.48964807702868, 107.830810546875 24.470900512719282, 107.86788940429688 24.45465036499095, 107.9132080078125 24.420893361323294, 107.95166015625 24.40588734853097, 107.9681396484375 24.409639018963116, 107.97225952148438 24.408388474538526, 108.0010986328125 24.415891555275127, 108.0120849609375 24.415891555275127, 108.02169799804688 24.414641072789088, 108.03680419921875 24.422143781858974, 108.03817749023438 24.425894969115173, 108.0450439453125 24.4308963786205, 108.06289672851562 24.429646044835188, 108.06564331054688 24.433397009006246, 108.07388305664062 24.43464730560575, 108.09036254882812 24.44214882486563, 108.09310913085938 24.440898602650527, 108.09585571289062 24.43839812102505, 108.10134887695312 24.437147861615614, 108.10134887695312 24.433397009006246, 108.10684204101562 24.4308963786205, 108.11920166015625 24.42714534008205, 108.12744140625 24.428395698655542, 108.1658935546875 24.415891555275127, 108.19747924804688 24.409639018963116, 108.22219848632812 24.419642928396602, 108.23455810546875 24.420893361323294, 108.24142456054688 24.424644585755384, 108.26614379882812 24.43839812102505, 108.2757568359375 24.437147861615614, 108.2867431640625 24.43839812102505, 108.31695556640625 24.42714534008205, 108.33892822265625 24.423394190003158, 108.34442138671875 24.41839248307936, 108.35403442382812 24.41214007065151, 108.358154296875 24.407137917727656, 108.38150024414062 24.408388474538526, 108.3966064453125 24.40088494789552, 108.40347290039062 24.394631668477125, 108.41995239257812 24.394631668477125, 108.43231201171875 24.392130270038866, 108.446044921875 24.378371693550225, 108.46939086914062 24.368364515573457, 108.4954833984375 24.378371693550225, 108.52981567382812 24.3771208396104, 108.56552124023438 24.370866384303945, 108.57925415039062 24.369615456124507, 108.59024047851562 24.36586259735842, 108.61221313476562 24.36711356265127, 108.66439819335938 24.36711356265127, 108.67950439453125 24.372117300111302, 108.71246337890625 24.364611619695374, 108.71932983398438 24.35710549396972, 108.75778198242188 24.35710549396972, 108.77288818359375 24.34709663380851, 108.77975463867188 24.34709663380851, 108.8140869140625 24.358356545843936, 108.81820678710938 24.35460335312115, 108.82919311523438 24.355854429728634, 108.86627197265625 24.350850049105077, 108.87588500976562 24.352101162808896, 108.88275146484375 24.34709663380851, 108.88824462890625 24.34709663380851, 108.91433715820312 24.335835720364003, 108.93218994140625 24.337086982410494, 108.95416259765625 24.34209190699892, 108.973388671875 24.337086982410494, 108.98162841796875 24.337086982410494, 109.017333984375 24.318316754254738, 109.02145385742188 24.302046975036554, 109.03244018554688 24.283271560273235, 109.07501220703125 24.25572926383073, 109.10385131835938 24.236947003917507, 109.11758422851562 24.22442395705756, 109.13543701171875 24.21690953772175, 109.14505004882812 24.21690953772175, 109.15328979492188 24.203131951027444, 109.16152954101562 24.195616275974363, 109.17251586914062 24.191858272317656, 109.19174194335938 24.191858272317656, 109.21371459960938 24.159284270056734, 109.22744750976562 24.156778233303402, 109.23019409179688 24.120435177678118, 109.2425537109375 24.114168089756113, 109.25765991210938 24.117928379336178, 109.26727294921875 24.114168089756113, 109.281005859375 24.11166116866358, 109.29885864257812 24.117928379336178, 109.3359375 24.11291463534678, 109.35791015625 24.106647179201786, 109.37164306640625 24.104140110840202, 109.390869140625 24.115421531891112, 109.40322875976562 24.117928379336178)";
    private static final String s = "LINESTRING (101.22665405273438 26.445983998856377, 101.239013671875 26.43860626788731)";

    public static void main(String[] args) throws Exception {
        WKTReader wktReader = new WKTReader();
        GeometryFactory geometryFactory = new GeometryFactory();
        MvtBuilder mvtBuilder = new MvtBuilder((byte) 6, 50, 27, geometryFactory);
        MvtLayer layer = mvtBuilder.getOrCreateLayer("test");
        Geometry geo = wktReader.read(s);
        Feature feature = new Feature(geo, Map.of());
        layer.addFeature(feature);
        byte[] byte0 = mvtBuilder.toBytes();
        byte[] bytes = ResourcesReader.readStream("D:\\_test\\vts3-7-2.pbf").readAllBytes();
//        byte[] bytes = ResourcesReader.readStream("D:\\_test\\vts8-209-96.pbf").readAllBytes();
        byte[] s = bytes;
        int[] c = new int[]{1, 2, 3, 4, 99};
        for (int u = 0; u < c.length; u++) {
            int l = c[u];
            if (l >= 0 && l < s.length) {
                s[l] = (byte) ~s[l];
            }
        }
        MvtParser.MvtFeatureLayer[] layers = MvtParser.parse2Wgs84Coords((byte) 3, 7, 2, s, geometryFactory);
        for (MvtParser.MvtFeatureLayer mvtFeatureLayer : layers) {
            System.out.println(mvtFeatureLayer.getLayerName());
        }

    }
}
